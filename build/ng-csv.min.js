/*! ng-csv 20-11-2014 */
!function(a,b){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(a){angular.isDefined(a.urlSanitizationWhitelist)?a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",["ngCsv.services"]),angular.module("ngCsv.services",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]),angular.module("ngCsv.services").service("CSV",["$q",function(b){var c="\r\n",d="%ef%bb%bf";this.stringifyField=function(a,b,c){return"string"==typeof a?(a=a.replace(/"/g,'""'),(c||a.indexOf(",")>-1||a.indexOf("\n")>-1||a.indexOf("\r")>-1)&&(a=b+a+b),a):"boolean"==typeof a?a?"TRUE":"FALSE":a},this.stringify=function(e,f){var g=b.defer(),h=this,i="",j="",k=b.when(e).then(function(b){if(b=angular.copy(b),angular.isDefined(f.header)&&f.header){var e,k;e=[],angular.forEach(f.header,function(a){this.push(h.stringifyField(a,f.txtDelim,f.quoteStrings))},e),k=e.join(f.fieldSep?f.fieldSep:","),j+=k+c}var l;l=angular.isArray(b)?b:b(),angular.forEach(l,function(a,b){var d,e;e=[],angular.forEach(a,function(a){this.push(h.stringifyField(a,f.txtDelim,f.quoteStrings))},e),d=e.join(f.fieldSep?f.fieldSep:","),j+=b<l.length?d+c:d}),a.navigator.msSaveOrOpenBlob?i=j:(f.addByteOrderMarker&&(i+=d),i+=j),g.resolve(i)});return"function"==typeof k["catch"]&&k["catch"](function(a){g.reject(a)}),g.promise}}]),function(a){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(a){angular.isDefined(a.urlSanitizationWhitelist)?a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",["ngCsv.services"]),angular.module("ngCsv.services",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]),angular.module("ngCsv.services").service("CSV",["$q",function(b){var c="\r\n",d="%ef%bb%bf";this.stringifyField=function(a,b,c){return"string"==typeof a?(a=a.replace(/"/g,'""'),(c||a.indexOf(",")>-1||a.indexOf("\n")>-1||a.indexOf("\r")>-1)&&(a=b+a+b),a):"boolean"==typeof a?a?"TRUE":"FALSE":a},this.stringify=function(e,f){var g=b.defer(),h=this,i="",j="",k=b.when(e).then(function(b){if(b=angular.copy(b),angular.isDefined(f.header)&&f.header){var e,k;e=[],angular.forEach(f.header,function(a){this.push(h.stringifyField(a,f.txtDelim,f.quoteStrings))},e),k=e.join(f.fieldSep?f.fieldSep:","),j+=k+c}var l;l=angular.isArray(b)?b:b(),angular.forEach(l,function(a,b){var d,e;e=[],angular.forEach(a,function(a){this.push(h.stringifyField(a,f.txtDelim,f.quoteStrings))},e),d=e.join(f.fieldSep?f.fieldSep:","),j+=b<l.length?d+c:d}),a.navigator.msSaveOrOpenBlob?i=j:(f.addByteOrderMarker&&(i+=d),i+=j),g.resolve(i)});return"function"==typeof k["catch"]&&k["catch"](function(a){g.reject(a)}),g.promise}}]),angular.module("ngCsv.directives").directive("ngCsv",["$parse","$q","CSV","$document","$timeout",function(b,c,d,e,f){return{restrict:"AC",scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",txtDelim:"@textDelimiter",quoteStrings:"@quoteStrings",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",addByteOrderMarker:"@addBom",ngClick:"&"},controller:["$scope","$element","$attrs","$transclude",function(a,b,e){function f(){var b={txtDelim:a.txtDelim?a.txtDelim:'"',quoteStrings:a.quoteStrings,addByteOrderMarker:a.addByteOrderMarker};return angular.isDefined(e.csvHeader)&&(b.header=a.$eval(a.header)),b.fieldSep=a.fieldSep?a.fieldSep:",",b}a.csv="",angular.isDefined(a.lazyLoad)&&"true"==a.lazyLoad||angular.isArray(a.data)&&a.$watch("data",function(){a.buildCSV()},!0),a.getFilename=function(){return a.filename||"download.csv"},a.buildCSV=function(){var g=c.defer();return b.addClass(e.ngCsvLoadingClass||"ng-csv-loading"),d.stringify(a.data(),f()).then(function(c){a.csv=c,b.removeClass(e.ngCsvLoadingClass||"ng-csv-loading"),g.resolve(c)}),a.$apply(),g.promise}}],link:function(b,c){function d(){var c=new Blob([b.csv],{type:"text/csv;charset=utf-8;"});if(a.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(c,b.getFilename());else{var d=angular.element("<a></a>");d.attr("href",a.URL.createObjectURL(c)),d.attr("download",b.getFilename()),e.find("body").append(d),f(function(){d[0].click(),d.remove()},null)}}c.bind("click",function(){b.buildCSV().then(function(){d()}),b.$apply()})}}}])}(a,b)}(window,document);