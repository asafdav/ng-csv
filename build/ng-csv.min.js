/*! ng-csv 28-03-2018 */
!function(a,b){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(a){angular.isDefined(a.urlSanitizationWhitelist)?a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",["ngCsv.services"]),angular.module("ngCsv.services",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ngCsv"),angular.module("ngCsv.services").service("CSV",["$q",function(a){var b="\r\n",c="\ufeff",d={"\\t":"	","\\b":"\b","\\v":"","\\f":"\f","\\r":"\r"};this.stringifyField=function(a,b){return"locale"===b.decimalSep&&this.isFloat(a)?a.toLocaleString():"."!==b.decimalSep&&this.isFloat(a)?a.toString().replace(".",b.decimalSep):"string"==typeof a?(a=a.replace(/"/g,'""'),(b.quoteStrings||a.indexOf(",")>-1||a.indexOf("\n")>-1||a.indexOf("\r")>-1)&&(a=b.txtDelim+a+b.txtDelim),a):"boolean"==typeof a?a?"TRUE":"FALSE":a},this.isFloat=function(a){return+a===a&&(!isFinite(a)||Boolean(a%1))},this.stringify=function(d,e){var f=a.defer(),g=this,h="",i="",j=a.when(d).then(function(a){if(angular.isDefined(e.header)&&e.header){var d,j;d=[],angular.forEach(e.header,function(a,b){this.push(g.stringifyField(a,e))},d),j=d.join(e.fieldSep?e.fieldSep:","),i+=j+b}var k=[];if(angular.isArray(a)?k=a:angular.isFunction(a)&&(k=a()),angular.isDefined(e.label)&&e.label&&"boolean"==typeof e.label){var l,m;l=[];var n=e.columnOrder?e.columnOrder:k[0];angular.forEach(n,function(a,b){var c=e.columnOrder?a:b;this.push(g.stringifyField(c,e))},l),m=l.join(e.fieldSep?e.fieldSep:","),i+=m+b}angular.forEach(k,function(a,c){var d,f,h=angular.copy(k[c]);f=[];var j=e.columnOrder?e.columnOrder:h;angular.forEach(j,function(a,b){var c=e.columnOrder?h[a]:a;this.push(g.stringifyField(c,e))},f),d=f.join(e.fieldSep?e.fieldSep:","),i+=c<k.length?d+b:d}),e.addByteOrderMarker&&(h+=c),h+=i,f.resolve(h)});return"function"==typeof j["catch"]&&j["catch"](function(a){f.reject(a)}),f.promise},this.isSpecialChar=function(a){return void 0!==d[a]},this.getSpecialChar=function(a){return d[a]}}]),angular.module("ngCsv.directives").directive("ngCsv",["$parse","$q","CSV","$document","$timeout",function(c,d,e,f,g){return{restrict:"AC",scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",columnOrder:"&csvColumnOrder",txtDelim:"@textDelimiter",decimalSep:"@decimalSeparator",quoteStrings:"@quoteStrings",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",addByteOrderMarker:"@addBom",ngClick:"&",charset:"@charset",label:"&csvLabel"},controller:["$scope","$element","$attrs","$transclude",function(a,b,c,f){function g(){var b={txtDelim:a.txtDelim?a.txtDelim:'"',decimalSep:a.decimalSep?a.decimalSep:".",quoteStrings:a.quoteStrings,addByteOrderMarker:a.addByteOrderMarker};return angular.isDefined(c.csvHeader)&&(b.header=a.$eval(a.header)),angular.isDefined(c.csvColumnOrder)&&(b.columnOrder=a.$eval(a.columnOrder)),angular.isDefined(c.csvLabel)&&(b.label=a.$eval(a.label)),b.fieldSep=a.fieldSep?a.fieldSep:",",b.fieldSep=e.isSpecialChar(b.fieldSep)?e.getSpecialChar(b.fieldSep):b.fieldSep,b}a.csv="",angular.isDefined(a.lazyLoad)&&"true"==a.lazyLoad||angular.isArray(a.data)&&a.$watch("data",function(b){a.buildCSV()},!0),a.getFilename=function(){return a.filename||"download.csv"},a.buildCSV=function(){var f=d.defer(),h=null;return b.addClass(c.ngCsvLoadingClass||"ng-csv-loading"),h=a.data(),angular.isFunction(h)&&(h=h()),e.stringify(h,g()).then(function(d){a.csv=d,b.removeClass(c.ngCsvLoadingClass||"ng-csv-loading"),f.resolve(d)}),a.$apply(),f.promise}}],link:function(c,d,e){d.bind("click",function(d){c.buildCSV().then(function(d){var e=new Blob([d],{type:"text/csv;charset=utf-8;"}),h=null;if(navigator.msSaveBlob)navigator.msSaveBlob(e,c.getFilename());else if(-1===navigator.userAgent.toLowerCase().indexOf("chrome")){var i=angular.element('<div data-tap-disabled="true"><a></a></div>'),j=angular.element(i.children()[0]);j.attr("href",a.URL.createObjectURL(e)),j.attr("download",c.getFilename()),j.attr("target","_blank"),f.find("body").append(i),g(function(){j[0].click(),j.remove()},null)}else{h=a.URL.createObjectURL(e);var k=b.createElement("a");k.href=h,k.setAttribute("download",c.getFilename()),k.click()}}),c.$apply()})}}}])}(window,document);